{"version":3,"file":"login-withoutpwd.js","sources":["uni_modules/uni-id-pages/pages/login/login-withoutpwd.vue","../../Edge download/HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniPage:/dW5pX21vZHVsZXNcdW5pLWlkLXBhZ2VzXHBhZ2VzXGxvZ2luXGxvZ2luLXdpdGhvdXRwd2QudnVl"],"sourcesContent":["<!-- 免密登录页 -->\r\n<template>\r\n\t<view class=\"uni-content\">\r\n\t\t<view class=\"login-logo\">\r\n\t\t\t<image :src=\"logo\"></image>\r\n\t\t</view>\r\n\t\t<!-- 顶部文字 -->\r\n\t\t<text class=\"title\">微信快捷登录</text>\r\n\t\t<!-- 微信登录按钮 -->\r\n\t\t<text class=\"tip\">将根据微信账号服务平台的授权范围获取你的信息</text>\r\n\t\t<view class=\"quickLogin\">\r\n\t\t\t<image @click=\"quickLogin\" src=\"/uni_modules/uni-id-pages/static/login/uni-fab-login/weixin.png\" mode=\"widthFix\"\r\n\t\t\t\tclass=\"quickLoginBtn\"></image>\r\n\t\t\t<uni-id-pages-agreements scope=\"register\" ref=\"agreements\"></uni-id-pages-agreements>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 隐藏其他登录方式 -->\r\n\t\t<!-- <uni-id-pages-fab-login ref=\"uniFabLogin\"></uni-id-pages-fab-login> -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport config from '@/uni_modules/uni-id-pages/config.js'\r\n\timport mixin from '@/uni_modules/uni-id-pages/common/login-page.mixin.js';\r\n\timport {store, mutations} from '@/uni_modules/uni-id-pages/common/store.js'\r\n\t\r\n\texport default {\r\n\t\tmixins: [mixin],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttype: \"weixin\", // 固定为微信登录\r\n\t\t\t\tlogo: \"/static/logo.png\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// 初始化页面\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tquickLogin() {\r\n\t\t\t\tif (this.needAgreements && !this.agree) {\r\n\t\t\t\t\treturn this.$refs.agreements.popup(this.quickLogin)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\t// 微信登录\r\n\t\t\t\tuni.login({\r\n\t\t\t\t\t\"provider\": \"weixin\",\r\n\t\t\t\t\t\"onlyAuthorize\": true,\r\n\t\t\t\t\tsuccess: async e => {\r\n\t\t\t\t\t\tthis.login({\r\n\t\t\t\t\t\t\tcode: e.code\r\n\t\t\t\t\t\t}, 'weixin')\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: async (err) => {\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '登录失败，请重试',\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 3000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tlogin(params, type) {\r\n\t\t\t\tconsole.log({params, type});\r\n\t\t\t\t\r\n\t\t\t\tconst uniIdCo = uniCloud.importObject(\"uni-id-co\", {\r\n\t\t\t\t\tcustomUI: true\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tuniIdCo.loginByWeixin(params)\r\n\t\t\t\t\t.then(result => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 登录成功后弹窗获取用户信息\r\n\t\t\t\t\t\tthis.getUserProfile()\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(e => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: e.message || '登录失败，请重试',\r\n\t\t\t\t\t\t\tconfirmText: \"知道了\",\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 获取微信用户信息\r\n\t\t\tgetUserProfile() {\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '温馨提示',\r\n\t\t\t\t\tcontent: '为了提供更好的服务，需要获取您的微信头像和昵称',\r\n\t\t\t\t\tconfirmText: '确认授权',\r\n\t\t\t\t\tcancelText: '暂不授权',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tuni.getUserProfile({\r\n\t\t\t\t\t\t\t\tdesc: '用于完善用户资料',\r\n\t\t\t\t\t\t\t\tsuccess: (userInfo) => {\r\n\t\t\t\t\t\t\t\t\tthis.updateUserInfoToDb(userInfo.userInfo)\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\t\t\t// 用户拒绝授权，仍然登录成功\r\n\t\t\t\t\t\t\t\t\tthis.loginSuccess()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 用户拒绝授权，仍然登录成功\r\n\t\t\t\t\t\t\tthis.loginSuccess()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\t\t\t\t\r\n\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\t// 其他平台直接登录成功\r\n\t\t\t\tthis.loginSuccess()\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 更新用户信息到数据库\r\n\t\t\tupdateUserInfoToDb(userInfo) {\r\n\t\t\t\tconst uniIdCo = uniCloud.importObject(\"uni-id-co\", {\r\n\t\t\t\t\tcustomUI: true\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tuniIdCo.updateUserInfo({\r\n\t\t\t\t\tnickname: userInfo.nickName,\r\n\t\t\t\t\tavatar_file: {\r\n\t\t\t\t\t\turl: userInfo.avatarUrl\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(() => {\r\n\t\t\t\t\t// 更新本地存储的用户信息\r\n\t\t\t\t\tmutations.updateUserInfo({\r\n\t\t\t\t\t\tnickname: userInfo.nickName,\r\n\t\t\t\t\t\tavatar_file: {\r\n\t\t\t\t\t\t\turl: userInfo.avatarUrl\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.loginSuccess()\r\n\t\t\t\t}).catch(e => {\r\n\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\tthis.loginSuccess()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 登录成功\r\n\t\t\tloginSuccess() {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '登录成功',\r\n\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\tduration: 2000\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// 触发登录成功事件\r\n\t\t\t\tmutations.loginSuccess({\r\n\t\t\t\t\tshowToast: false\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t@import \"@/uni_modules/uni-id-pages/common/login-page.scss\";\r\n\r\n\t@media screen and (min-width: 690px) {\r\n\t\t.uni-content {\r\n\t\t\theight: 350px;\r\n\t\t}\r\n\t}\r\n\r\n\t.uni-content,\r\n\t.quickLogin {\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\t/* #endif */\r\n\t}\r\n\r\n\t.phone-box {\r\n\t\tposition: relative;\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tdisplay: flex;\r\n\t\t/* #endif */\r\n\t}\r\n\r\n\t.area {\r\n\t\tposition: absolute;\r\n\t\tleft: 10px;\r\n\t\tz-index: 9;\r\n\t\ttop: 12px;\r\n\t\tfont-size: 14px;\r\n\t}\r\n\r\n\t.area::after {\r\n\t\tcontent: \"\";\r\n\t\tborder: 3px solid transparent;\r\n\t\tborder-top-color: #000;\r\n\t\ttop: 12px;\r\n\t\tleft: 3px;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t/* #ifdef MP */\r\n\t// 解决小程序端开启虚拟节点virtualHost引起的 class = input-box丢失的问题 [详情参考](https://uniapp.dcloud.net.cn/matter.html#%E5%90%84%E5%AE%B6%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6%E4%B8%8D%E5%90%8C-%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E7%9A%84%E5%B9%B3%E5%8F%B0%E5%85%BC%E5%AE%B9%E9%97%AE%E9%A2%98)\r\n\t.phone-box ::v-deep .uni-easyinput__content,\r\n\t/* #endif */\r\n\t.input-box {\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tbox-sizing: border-box;\r\n\t\t/* #endif */\r\n\t\tflex: 1;\r\n\t\tpadding-left: 45px;\r\n\t\tmargin-bottom: 10px;\r\n\t\tborder-radius: 0;\r\n\t}\r\n\r\n\t.quickLogin {\r\n\t\theight: 350px;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.quickLoginBtn {\r\n\t\tmargin: 20px 0;\r\n\t\twidth: 450rpx;\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tmax-width: 230px;\r\n\t\t/* #endif */\r\n\t\theight: 82rpx;\r\n\t}\r\n\r\n\t.tip {\r\n\t\tmargin-top: -15px;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\r\n\t@media screen and (min-width: 690px) {\r\n\t\t.quickLogin {\r\n\t\t\theight: auto;\r\n\t\t}\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/git depository/xydp-uniapp/uni_modules/uni-id-pages/pages/login/login-withoutpwd.vue'\nwx.createPage(MiniProgramPage)"],"names":["mixin","uni","uniCloud","mutations"],"mappings":"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"}